language: php

php:
  - 5.5

before_script:
  - curl -s http://getcomposer.org/installer | php
  - php composer.phar install --dev --no-interaction
  - make symfony.dev.rebuild

script:
  - make symfony.test.bdd suite=quickstart_app config=test/behat.yml
  - make symfony.test.unit suite=app
  - make symfony.test.spec config=test/phpspec.yml
  - make scrutinizer.coverage

after_success:
  - make build.package

after_failure:
  - make symfony.logs

branches:
  except:
    - /^build-[0-9a-z\-\/]*/

env:
  global:
    - secure: VbBYQenby0LIJ9kEKZwC+4ffCW9lGCSt5O2QkUUAKhBNBoYw7KufEOhAVNwbRM4fOTnkjhyxxvwIdgVZprT9VZQnHqJgQ5uVs45hADE2HSevP1PdkrX7YJnbkiLGiOQe4u6Ctg0KSTRBecSAp1i3cIunPeSc+hbfQW2eo5Q/h0M=

deploy:
  provider: heroku
  api_key:
    secure: Z3ayUw0ugCox7Dyvw5o1L3xCySlf8R5Pi124xffqvw5A/jnvi6yyZ/bUvwonNWTYhsR2WydAjgz9KFSjhgUEUNQpHa+rpSMpiZCCkmblAhdakHHVo9AR3X165sM/VGLFVnC69XkfvS/F8l6iAqoyWQAdjaR6GLtnY/dxgMmavko=
  app: symfony-quickstart
  on:
    all_branches: true
  run:
      - "make symfony.dev.rebuild"
